<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Portal</title>
</head>
<body>
    <h1>Download Portal</h1>
    <p id="linkMessage">Checking available download link...</p>
    <button id="downloadButton" onclick="visitLink()">Get Download Link</button>

    <script>
        // Retrieve URL parameters
        function getURLParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Retrieve shortlink back-halves from URL parameters
        const uniqueA = getURLParameter("a");
        const uniqueB = getURLParameter("b");
        const uniqueC = getURLParameter("c");

        // Check for missing parameters
        if (!uniqueA || !uniqueB || !uniqueC) {
            document.getElementById("linkMessage").textContent = "Error 404 link";
            document.getElementById("downloadButton").disabled = true;
            throw new Error("Missing shortlink parameters");
        }

        // Shortlink domains and corresponding back-halves
        const shortlinks = {
            "bitly": `https://bit.ly/${uniqueA}`,
            "safelinku": `https://safelinku.com/${uniqueB}`,
            "ouoio": `https://ouo.io/${uniqueC}`
        };

        // Set expiration time (25 hours in milliseconds)
        const expirationTime = 25 * 60 * 60 * 1000;

        // Check if a link has expired based on domain
        function isExpired(domain) {
            const lastVisitTime = localStorage.getItem(`visited-${domain}-timestamp`);
            if (!lastVisitTime) return true; // If no timestamp, consider it expired

            const currentTime = Date.now();
            return currentTime - parseInt(lastVisitTime) > expirationTime;
        }

        // Get the next available link based on domain visits
        function getNextLink() {
            for (const [domain, url] of Object.entries(shortlinks)) {
                if (!localStorage.getItem(`visited-${domain}`) || isExpired(domain)) {
                    return { domain, url };
                }
            }
            return null; // All links have been visited recently
        }

        // Visit the selected link and store visit info by domain
        function visitLink() {
            const nextLink = getNextLink();
            if (nextLink) {
                window.open(nextLink.url, "_blank");
                // Mark the domain as visited and save the current timestamp
                localStorage.setItem(`visited-${nextLink.domain}`, "true");
                localStorage.setItem(`visited-${nextLink.domain}-timestamp`, Date.now().toString());
                displayLinkMessage();
            } else {
                alert("EN: IP limit exceeded. Please refresh your IP (airplane mode for 10 seconds & clear browser data) or try again after 25 hours.\n\nID: Batas IP terlampaui. Harap segarkan IP Anda (mode pesawat selama 10 detik & hapus data browser) atau coba lagi setelah 25 jam.");
            }
        }

        // Display the next available link message
        function displayLinkMessage() {
            const nextLink = getNextLink();
            const linkMessage = document.getElementById("linkMessage");

            if (nextLink) {
                linkMessage.textContent = `Your next available download link is on ${nextLink.domain}. Click the button below to proceed.`;
            } else {
                linkMessage.textContent = "EN: IP limit exceeded. Please refresh your IP (airplane mode for 10 seconds & clear browser data) or try again after 25 hours.\n\nID: Batas IP terlampaui. Harap segarkan IP Anda (mode pesawat selama 10 detik & hapus data browser) atau coba lagi setelah 25 jam.";
                document.getElementById("downloadButton").disabled = true;
            }
        }

        // Initialize the message on page load
        displayLinkMessage();
    </script>
</body>
</html>
